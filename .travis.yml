language: node_js
node_js: 
  - "stable"
cache:
  directories:
    - "node_modules"
services:
  - postgresql
env: 
  NODE_ENV=test
  DATABASE_URL=postgres://postgres:postgres@127.0.0.1:5432/banka_test
before_install: cd ./server
install:
    - npm install
before_script:
  - psql -c "DROP DATABASE banka_test;" -U postgres
  - psql -c "CREATE DATABASE banka_test;" -U postgres
  - psql -c "CREATE USER postgres WITH PASSWORD 'postgres';" -U postgres
script:
    - npm run test
after_success:
     npm run coverage
addons: 
  postgresql: "11"

